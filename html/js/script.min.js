function qa(e){return document.querySelectorAll(e)}function q(e){return document.querySelector(e)}function OpenDownList(){q(".downlist-cover").style.display="block",setTimeout(()=>{q(".downlist-cover").style.opacity=1,q(".downlist-window").style.top="15%"},50)}function CloseDownList(){q(".downlist-cover").style.opacity=0,q(".downlist-window").style.top="calc(15% + 2rem)",setTimeout(()=>{q(".downlist-cover").style.display="none"},500)}function RequireScan(){fetch("/scan")}function HTMLEncode(e){var t=document.createElement("div");null!=t.textContent?t.textContent=e:t.innerText=e;var n=t.innerHTML;return t=null,n}function ClearVideos(){shown_videos={},down_status=0,e=qa(".item");for(var t=1;t<e.length;t++)e[t].remove();e=qa("#down-list>.list-item");for(t=0;t<e.length;t++)e[t].remove()}function AddVideo(e,t){if(null==shown_videos[e]){id=++count;var n=document.createElement("div");n.setAttribute("class","item"),n.setAttribute("id","item"+id),n.setAttribute("down-url",e),n.style.opacity="0";var o=[];for(i=0;i<t.length;i++)o.push(HTMLEncode(t[i]));n.innerHTML='<input type="checkbox" class="select-vid"><div class="vid-container"><video-js oncontextmenu="return false" controls id="video'+id+'"><source src="'+e+'"></video-js></div><div class="item-opt"><div class="filename"></div><input class="input-filename" id="filename'+id+'" list="list'+id+'"><datalist id="list'+id+'"><option>'+o.join("</option><option>")+'</option></datalist><div class="fileext"></div><select class="select-fileext" id="ext'+id+'"><option>.mp4</option><option>.mkv</option><option>.m4v</option><option>.flv</option></select><button class="btn" onclick="Download('+id+')">Download</button>',q(".content").appendChild(n);for(i=0;i<o.length;i++)if(!o[i].toLowerCase().includes("classin")&&!o[i].toLowerCase().includes("classroom")){q("#filename"+id).value=o[i];break}shown_videos[e]={titles:t,id:id},videojs("video"+id),setTimeout(()=>{n.style.opacity="1"},50)}else for(var i=0;i<t.length;i++)shown_videos[e].titles.includes(t[i])||(q("#list"+shown_videos[e].id).innerHTML+="<option>"+HTMLEncode(t[i])+"</option>",shown_videos[e].titles.push(t[i]))}function GetVideos(e=!0){fetch("/get-titles").then(e=>e.json(),()=>{location.href="about:blank"}).then(t=>{for(var n in t)AddVideo(n,t[n]);e&&setTimeout(GetVideos,1e3)})}function StartModify(){modifying=!0,clearTimeout(modify_timeout),q(".delay-int").style.boxShadow="0 0 2px 2px #e04",modify_timeout=setTimeout(StopModify,1e4)}function StopModify(){ChangeDelayTime(),modifying=!1,clearTimeout(modify_timeout),q(".delay-int").style.boxShadow=""}function RefreshStatus(){fetch("/get-status").then(e=>e.json(),()=>{location.href="about:blank"}).then(e=>{q(".conf-panel>.check-big").checked=e.autoscan,modifying||(q(".delay-int").value=e.wait_interval),setTimeout(RefreshStatus,1e3)})}function SwitchAutoScan(){fetch(q(".conf-panel>.check-big").checked?"/enable-autoscan":"/disable-autoscan")}function ChangeDelayTime(){fetch("/set-autoscan-delay",{method:"POST",body:q(".delay-int").value.toString()})}function RefreshDownloads(){fetch("/download-status").then(e=>e.json(),()=>{location.href="about:blank"}).then(e=>{if(e.length>down_status)for(var t=down_status;t<e.length;t++){var n=document.createElement("div");n.setAttribute("id","down-item"+t),n.setAttribute("class","list-item"),n.innerHTML='<div class="down-filename">'+HTMLEncode(e[t].name)+'</div><div class="down-filepath">'+HTMLEncode(e[t].path)+'</div><div class="percentage">'+e[t].percent.toFixed(2)+'%</div><div class="progress-bar-container"><div class="progress-bar"></div></div><div class="cancel-btn" id="cancel-btn'+t+'">Ã—</div><div class="error-message">'+HTMLEncode(e[t].msg)+"</div>",q("#down-list").appendChild(n),q("#down-item"+t+">.cancel-btn").onclick=Function('fetch("/cancel-download/'+t+'",{method:"DELETE"})'),down_status++}var o=0;for(t=0;t<e.length;t++){var i=q("#down-item"+t+">.down-filename"),s=q("#down-item"+t+">.down-filepath"),a=q("#down-item"+t+">.percentage"),d=q("#down-item"+t+">.error-message"),l=q("#down-item"+t+" .progress-bar"),c=q("#cancel-btn"+t),r=HTMLEncode(e[t].name),u=HTMLEncode(e[t].path),f=HTMLEncode(e[t].msg);i.innerHTML!==r&&(i.innerHTML=r),s.innerHTML!==u&&(s.innerHTML=u),a.innerHTML!==e[t].percent.toFixed(2)+"%"&&(a.innerHTML=e[t].percent.toFixed(2)+"%"),d.innerHTML!==f&&(d.innerHTML=f),l.style.width=e[t].percent.toFixed(2)+"%",o+=5==e[t].status||1==e[t].status?1:0,1==e[t].status?l.classList.contains("progress-bar-downloading")||l.setAttribute("class","progress-bar progress-bar-downloading"):4==e[t].status?(l.classList.contains("progress-bar-success")||l.setAttribute("class","progress-bar progress-bar-success"),c.setAttribute("class","cancel-btn-disabled"),c.onclick=null):2!=e[t].status&&3!=e[t].status||(l.classList.contains("progress-bar-failed")||l.setAttribute("class","progress-bar progress-bar-failed"),c.setAttribute("class","cancel-btn-disabled"),c.onclick=null)}q(".notify-num").innerHTML!=o&&(q(".notify-num").innerHTML=o),setTimeout(RefreshDownloads,500)})}function Download(e){fetch("/require-download",{method:"POST",body:JSON.stringify({path:q("#path").value,downloads:[{url:q("#item"+e).getAttribute("down-url"),name:q("#filename"+e).value+q("#ext"+e).value}]})})}function Download_Select(){for(var e=qa(".item>.select-vid:checked"),t=0;t<e.length;t++)Download(parseInt(e[t].parentNode.getAttribute("id").slice(4)))}var count=0,shown_videos={},modifying=!1,modify_timeout=0,modify_focus=!1,down_status=0;GetVideos(),RefreshStatus(),RefreshDownloads();